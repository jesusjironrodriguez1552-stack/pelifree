<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Películas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 40px;
            color: #fff;
            font-size: 32px;
        }
        
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }
        
        .movie-item {
            background-color: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #444;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .movie-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }
        
        .movie-image-container {
            width: 100%;
            height: 300px;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            position: relative;
            background-color: #444;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .movie-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .movie-image:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        
        .image-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #444, #666);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #ccc;
            font-size: 24px;
        }
        
        .image-placeholder.hidden {
            display: none;
        }
        
        .movie-title {
            color: #fff;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .movie-synopsis {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            line-height: 1.5;
            text-align: justify;
            font-size: 14px;
            margin-bottom: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .movie-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .movie-year {
            background-color: #444;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #ccc;
        }
        
        .movie-genre {
            background-color: #555;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #fff;
        }
        
        .watch-button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .watch-button:hover {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4);
        }
        
        .play-icon {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 4px solid #666;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .format-info {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .movie-image-container:hover .format-info {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .movies-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .movie-image-container {
                height: 250px;
            }
            
            .movie-item {
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 30px;
            }
            
            .movie-info {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .movie-image-container {
                height: 200px;
            }
            
            .movie-synopsis {
                padding: 10px;
                font-size: 13px;
            }
            
            .watch-button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎬 Catálogo de Películas</h1>
        
        <div class="movies-grid">
            
            <!-- PELÍCULA 1 -->
            <div class="movie-item">
                <div class="movie-image-container">
                    <div class="loading-spinner"></div>
                    <div class="image-placeholder">
                        <div>🎬</div>
                        <div style="font-size: 14px; margin-top: 10px;">Cargando imagen...</div>
                    </div>
                    <img data-src-webp="https://pixeldrain.com/api/file/BBQtbbrW" 
                         data-src-jpg="https://pixeldrain.com/api/file/BBQtbbrW"
                         data-src-avif="https://pixeldrain.com/api/file/BBQtbbrW"
                         alt="Poster It Eso" 
                         class="movie-image"
                         style="display: none;">
                    <div class="format-info"></div>
                </div>
                <h2 class="movie-title">It Eso</h2>
                <div class="movie-info">
                    <span class="movie-year">2017</span>
                    <span class="movie-genre">Terror</span>
                </div>
                <div class="movie-synopsis">
                    En el verano de 1989, un grupo de niños maltratados se unieron para destruir a un monstruo cambia-formas, que se disfraza de payaso y se aprovecha de los niños de Derry, su pequeño pueblo de Maine.
                </div>
                <a href="https://pixeldrain.com/u/Q8KRdN3t" 
                   class="watch-button" 
                   target="_blank">
                    <span class="play-icon">▶️</span>Ver Película
                </a>
            </div>
            
            <!-- PELÍCULA 2 -->
            <div class="movie-item">
                <div class="movie-image-container">
                    <div class="loading-spinner"></div>
                    <div class="image-placeholder">
                        <div>🎬</div>
                        <div style="font-size: 14px; margin-top: 10px;">Cargando imagen...</div>
                    </div>
                    <img data-src-webp="https://pixeldrain.com/u/83BfbgBo" 
                         data-src-jpg="https://pixeldrain.com/u/83BfbgBo"
                         data-src-avif="https://pixeldrain.com/u/83BfbgBo"
                         alt="Poster La hora de la desaparición" 
                         class="movie-image"
                         style="display: none;">
                    <div class="format-info"></div>
                </div>
                <h2 class="movie-title">La hora de la desaparición</h2>
                <div class="movie-info">
                    <span class="movie-year">2023</span>
                    <span class="movie-genre">Terror/Misterio</span>
                </div>
                <div class="movie-synopsis">
                    Cuando todos los niños de una secundaria, menos uno, desaparecen misteriosamente la misma noche y exactamente a la misma hora, toda la comunidad de un pequeño pueblo se pregunta quién (o qué) es responsable de su desaparición.
                    <br><br>
                    <strong>Actores:</strong> Julia Garner, Josh Brolin, Alden Ehrenreich, Austin Abrams, Benedict Wong, Amy Madigan, Cary Christopher, Toby Huss, Whitmer Thomas, Callie Schuttera, June Diane Raphael, Scarlett Sher, Jason Turner, Anny Jules, Ali Burch
                </div>
                <a href="https://pixeldrain.com/u/AiTPN7Sm" 
                   class="watch-button" 
                   target="_blank">
                    <span class="play-icon">▶️</span>Ver Película
                </a>
            </div>
            
            <!-- PELÍCULA 3 -->
            <div class="movie-item">
                <div class="movie-image-container">
                    <div class="image-placeholder">
                        <div>🚀</div>
                        <div style="font-size: 14px; margin-top: 10px;">Película 3</div>
                    </div>
                </div>
                <h2 class="movie-title">Título de la Película 3</h2>
                <div class="movie-info">
                    <span class="movie-year">2024</span>
                    <span class="movie-genre">Ciencia Ficción</span>
                </div>
                <div class="movie-synopsis">
                    Descripción de la tercera película. Puedes agregar información sobre el director, año de estreno, género, o cualquier dato interesante que quieras compartir. Una aventura espacial épica llena de efectos especiales.
                </div>
                <a href="https://pixeldrain.com/u/CAMBIAR_POR_TU_URL3" 
                   class="watch-button" 
                   target="_blank">
                    <span class="play-icon">▶️</span>Ver Película
                </a>
            </div>
            
            <!-- PELÍCULA 4 -->
            <div class="movie-item">
                <div class="movie-image-container">
                    <div class="image-placeholder">
                        <div>😂</div>
                        <div style="font-size: 14px; margin-top: 10px;">Película 4</div>
                    </div>
                </div>
                <h2 class="movie-title">Título de la Película 4</h2>
                <div class="movie-info">
                    <span class="movie-year">2023</span>
                    <span class="movie-genre">Comedia</span>
                </div>
                <div class="movie-synopsis">
                    Sinopsis de la cuarta película. Continúa agregando más bloques como este para incluir todas las películas que quieras en tu catálogo. Una comedia divertida que te hará reír a carcajadas.
                </div>
                <a href="https://pixeldrain.com/u/CAMBIAR_POR_TU_URL4" 
                   class="watch-button" 
                   target="_blank">
                    <span class="play-icon">▶️</span>Ver Película
                </a>
            </div>
            
            <!-- PELÍCULA 5 -->
            <div class="movie-item">
                <div class="movie-image-container">
                    <div class="image-placeholder">
                        <div>🔥</div>
                        <div style="font-size: 14px; margin-top: 10px;">Película 5</div>
                    </div>
                </div>
                <h2 class="movie-title">Título de la Película 5</h2>
                <div class="movie-info">
                    <span class="movie-year">2024</span>
                    <span class="movie-genre">Thriller</span>
                </div>
                <div class="movie-synopsis">
                    Una película llena de suspenso y misterio que te mantendrá adivinando hasta el final. Con giros inesperados y una trama que te atrapará desde el primer minuto.
                </div>
                <a href="https://pixeldrain.com/u/CAMBIAR_POR_TU_URL5" 
                   class="watch-button" 
                   target="_blank">
                    <span class="play-icon">▶️</span>Ver Película
                </a>
            </div>
            
        </div>
    </div>

    <script>
        // Sistema avanzado de carga de imágenes con múltiples formatos y fallback
        function loadImageWithFallback(img, placeholder, spinner) {
            // Detectar soporte de formatos
            const supportsWebP = () => {
                const canvas = document.createElement('canvas');
                canvas.width = canvas.height = 1;
                return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
            };

            const supportsAVIF = () => {
                const canvas = document.createElement('canvas');
                canvas.width = canvas.height = 1;
                return canvas.toDataURL('image/avif').indexOf('data:image/avif') === 0;
            };

            // Obtener URLs de diferentes formatos
            const webpSrc = img.getAttribute('data-src-webp');
            const jpgSrc = img.getAttribute('data-src-jpg');
            const avifSrc = img.getAttribute('data-src-avif');
            
            // Determinar el orden de prioridad basado en el soporte del navegador
            let sources = [];
            
            // AVIF tiene la mejor compresión, pero menos soporte
            if (avifSrc && supportsAVIF()) {
                sources.push({ url: avifSrc, format: 'AVIF' });
            }
            
            // WebP tiene buen soporte y compresión
            if (webpSrc && supportsWebP()) {
                sources.push({ url: webpSrc, format: 'WebP' });
            }
            
            // JPG es el fallback universal
            if (jpgSrc) {
                sources.push({ url: jpgSrc, format: 'JPG' });
            }
            
            // Si no hay fuentes, mostrar error
            if (sources.length === 0) {
                showError(placeholder, spinner, 'No hay fuentes de imagen disponibles');
                return;
            }
            
            // Intentar cargar imágenes en orden de prioridad
            tryLoadImage(sources, 0, img, placeholder, spinner);
        }
        
        function tryLoadImage(sources, index, img, placeholder, spinner) {
            if (index >= sources.length) {
                showError(placeholder, spinner, 'Todas las fuentes fallaron');
                return;
            }
            
            const source = sources[index];
            const testImg = new Image();
            
            // Configurar headers para mejor compatibilidad
            testImg.crossOrigin = 'anonymous';
            
            testImg.onload = function() {
                // Éxito: mostrar la imagen
                img.src = source.url;
                img.style.display = 'block';
                
                if (placeholder) placeholder.classList.add('hidden');
                if (spinner) spinner.style.display = 'none';
                
                // Mostrar información del formato cargado
                const formatInfo = img.parentElement.querySelector('.format-info');
                if (formatInfo) {
                    formatInfo.textContent = source.format;
                }
                
                console.log(`✅ Imagen cargada exitosamente: ${source.format}`);
            };
            
            testImg.onerror = function() {
                console.warn(`❌ Error cargando ${source.format}, intentando siguiente formato...`);
                // Error: intentar con la siguiente fuente
                setTimeout(() => {
                    tryLoadImage(sources, index + 1, img, placeholder, spinner);
                }, 100); // Pequeño delay para evitar spam de requests
            };
            
            // Configurar timeout para evitar esperas infinitas
            setTimeout(() => {
                if (!testImg.complete) {
                    console.warn(`⏰ Timeout cargando ${source.format}, intentando siguiente formato...`);
                    tryLoadImage(sources, index + 1, img, placeholder, spinner);
                }
            }, 5000); // 5 segundos de timeout
            
            // Iniciar la carga
            testImg.src = source.url;
        }
        
        function showError(placeholder, spinner, message) {
            if (spinner) spinner.style.display = 'none';
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="font-size: 24px;">🖼️</div>
                    <div style="font-size: 12px; margin-top: 10px; text-align: center; color: #ff6b6b;">
                        ${message}<br>
                        <span style="font-size: 10px; color: #888; margin-top: 5px; display: block;">
                            Verifica las URLs de las imágenes
                        </span>
                    </div>
                `;
            }
            console.error(`🚫 Error final: ${message}`);
        }
        
        // Cargar todas las imágenes cuando la página esté lista
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎬 Iniciando sistema de carga de imágenes...');
            
            const movieItems = document.querySelectorAll('.movie-item');
            
            movieItems.forEach((item, index) => {
                const img = item.querySelector('.movie-image');
                const placeholder = item.querySelector('.image-placeholder');
                const spinner = item.querySelector('.loading-spinner');
                
                if (img && (img.getAttribute('data-src-webp') || img.getAttribute('data-src-jpg') || img.getAttribute('data-src-avif'))) {
                    console.log(`📋 Procesando imagen ${index + 1}...`);
                    loadImageWithFallback(img, placeholder, spinner);
                } else {
                    // No hay imagen para cargar, ocultar spinner
                    if (spinner) spinner.style.display = 'none';
                    console.log(`ℹ️ No hay fuentes de imagen para el item ${index + 1}`);
                }
            });
        });

        // Función mejorada para agregar nueva película con soporte para múltiples formatos
        function addMovie(title, year, genre, synopsis, imageUrls, watchUrl) {
            const moviesGrid = document.querySelector('.movies-grid');
            
            // imageUrls puede ser un string (una sola URL) o un objeto con múltiples formatos
            let imageSrcAttrs = '';
            if (typeof imageUrls === 'string') {
                // Solo una URL, asumir que es compatible con todos los formatos
                imageSrcAttrs = `
                    data-src-webp="${imageUrls}" 
                    data-src-jpg="${imageUrls}"
                    data-src-avif="${imageUrls}"
                `;
            } else if (typeof imageUrls === 'object') {
                // Múltiples URLs para diferentes formatos
                imageSrcAttrs = `
                    ${imageUrls.webp ? `data-src-webp="${imageUrls.webp}"` : ''}
                    ${imageUrls.jpg ? `data-src-jpg="${imageUrls.jpg}"` : ''}
                    ${imageUrls.avif ? `data-src-avif="${imageUrls.avif}"` : ''}
                `;
            }
            
            const movieHTML = `
                <div class="movie-item">
                    <div class="movie-image-container">
                        <div class="loading-spinner"></div>
                        <div class="image-placeholder">
                            <div>🎬</div>
                            <div style="font-size: 14px; margin-top: 10px;">Cargando imagen...</div>
                        </div>
                        <img ${imageSrcAttrs}
                             alt="Poster ${title}" 
                             class="movie-image"
                             style="display: none;">
                        <div class="format-info"></div>
                    </div>
                    <h2 class="movie-title">${title}</h2>
                    <div class="movie-info">
                        <span class="movie-year">${year}</span>
                        <span class="movie-genre">${genre}</span>
                    </div>
                    <div class="movie-synopsis">
                        ${synopsis}
                    </div>
                    <a href="${watchUrl}" 
                       class="watch-button" 
                       target="_blank">
                        <span class="play-icon">▶️</span>Ver Película
                    </a>
                </div>
            `;
            
            moviesGrid.insertAdjacentHTML('beforeend', movieHTML);
            
            // Cargar la imagen del nuevo elemento
            const newItem = moviesGrid.lastElementChild;
            const img = newItem.querySelector('.movie-image');
            const placeholder = newItem.querySelector('.image-placeholder');
            const spinner = newItem.querySelector('.loading-spinner');
            
            loadImageWithFallback(img, placeholder, spinner);
        }

        // Ejemplos de uso:
        
        // Con una sola URL (funciona para todos los formatos):
        // addMovie("Película Ejemplo", "2024", "Acción", "Sinopsis...", "https://ejemplo.com/imagen", "https://ejemplo.com/pelicula");
        
        // Con múltiples formatos específicos:
        // addMovie("Película Ejemplo 2", "2024", "Drama", "Sinopsis...", {
        //     webp: "https://ejemplo.com/imagen.webp",
        //     jpg: "https://ejemplo.com/imagen.jpg",
        //     avif: "https://ejemplo.com/imagen.avif"
        // }, "https://ejemplo.com/pelicula");
    </script>
</body>
</html>
